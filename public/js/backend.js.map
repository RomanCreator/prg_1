{"version":3,"sources":["backend.js","countdown.js","imagepicker.js","ymap.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"backend.js","sourcesContent":["/**\n * Created by roman on 29.06.16.\n */\n$(document).ready(function () {\n    /**\n     * Инициализация всех тултипов\n     */\n    $('[data-toggle=\"tooltip\"]').tooltip();\n    var $CkEditor = $('[data-toggle=\"ckeditor\"]');\n    for (var i = $CkEditor.length; i--;) {\n        /* Маленькая инициализационная область для CKEditor */\n        var name = $CkEditor.eq(i).attr('name');\n        var id = $CkEditor.eq(i).attr('id');\n\n        var errMessage = false;\n        if (name == undefined) {\n             errMessage = 'Не задан атрибут name!';\n        }\n\n        if (id == undefined) {\n            errMessage += ' Не задан атрибут id!';\n        }\n\n        if (CKEDITOR == undefined) {\n            errMessage += 'Не определен CkEditor';\n        }\n\n        if (errMessage) {\n            errMessage += ' Для элемента '+$CkEditor.eq(i)[0];\n            console.log(errMessage);\n            continue;\n        }\n\n        /* Если же все условия выполнены для замечательной работы CKEditor инициализируем его */\n        CKEDITOR.replace(id);\n    }\n\n\n    $('[data-toggle=\"countdown\"]').countdown();\n    $('[data-toggle=\"imagepicker\"]').imagepicker();\n    $('[data-toggle=\"ymap\"]').ymap();\n});","/**\n * Created by roman on 29.06.16.\n */\n+function ($) {\n    'use strict';\n\n    var CountdownElemForm = function (element, options) {\n        this.$element = $(element);\n        this.CurrentOption = this.getOptions (options);\n        this.$form = this.$element.closest('form');\n        this.intervalId = null;\n        this.countdownState = 'start';\n        this.innerHtml = null;\n\n        var self = this;\n        this.$form.bind('submit.countdown', function () {\n            return self.sendForm();\n        });\n\n        this.$element.bind('click.countdown', function () {\n            if (self.countdownState == 'start') {\n                self.countdownState = 'proccess';\n                self.innerHtml = self.$element.html();\n                self.$element.html(self.CurrentOption.countdownTime);\n                self.intervalId = setInterval(function () {\n                    self.action.call(self);\n                }, self.CurrentOption.countdownIntervalSec*1000);\n            }\n\n            if (self.countdownState == 'end') {\n                return true;\n            }\n            return false;\n        });\n    };\n\n    /**\n     * Сам непосредственный экшн для отсчета\n     */\n    CountdownElemForm.prototype.action = function () {\n        var time = parseInt(this.$element.html());\n        if (time > 0) {\n            time--;\n            this.$element.html(time);\n        } else {\n            this.$element.html(this.innerHtml);\n            this.countdownState = 'end';\n            clearInterval(this.intervalId);\n        }\n    }\n\n    /**\n     * Разршаем отправку формы тогда и только тогда, когда\n     * заканчивается обратный отсчет, до этого форму не отрпавляем\n     * @returns {boolean}\n     */\n    CountdownElemForm.prototype.sendForm = function () {\n        if (this.countdownState !== 'end') {\n            return false;\n        }\n\n        return true;\n    }\n\n    CountdownElemForm.prototype.options = {\n        countdownTime: 3,\n        countdownIntervalSec: 1,\n    };\n\n    CountdownElemForm.prototype.getOptions = function (options) {\n        if (options && (typeof options) == 'Object') {\n            for (var key in this.options) {\n                if (!options[key]) {\n                    options[key] = this.options[key];\n                };\n            }\n\n            return options;\n        }\n\n        return this.options;\n    };\n\n    var Countdown = function (options) {\n        //вернуть надо объект jQuery\n        return this.each(function () {\n            new CountdownElemForm(this, options);\n        });\n    };\n\n\n    var old = $.fn.countdown;\n\n    $.fn.countdown = Countdown;\n    $.fn.countdown.constructor = Countdown;\n\n    $.fn.countdown.noConflict = function () {\n        $.fn.countdown = old;\n        return this;\n    }\n\n}(jQuery);","/**\n * Created by roman on 10.07.16.\n */\n+function ($) {\n    'use strict';\n\n    var ImagePickerElem = function (element, option) {\n        this.template = '<div class=\"imagepicker__container\">'+\n                            '<label class=\"imagepicker\">'+\n                                '<div class=\"imagepicker__hover-place\">'+\n                                '</div>'+\n                            '</label>'+\n                        '</div>';\n        this.inputClass = 'imagepicker__input';\n        this.templateImg = '<img class=\"imagepicker__miniature img-responsive\">';\n        this.$element = $(element);\n\n        this.init();\n\n        var self = this;\n        this.$element.on('change', function () {\n            self.changedImage();\n        });\n    }\n\n    ImagePickerElem.prototype.init = function () {\n        this.$element.addClass(this.inputClass);\n        var src = this.$element.data('src');\n        this.$template = $(this.template);\n        this.$element.after(this.$template);\n\n        if (src != undefined) {\n            var $img = $(this.templateImg).attr('src', src);\n            this.$template.find('.imagepicker__hover-place').append($img);\n        }\n\n        this.$template.find('.imagepicker__hover-place').append(this.$element);\n    }\n\n    ImagePickerElem.prototype.changedImage = function () {\n        if (this.$element[0] && this.$element[0].files[0]) {\n            var file = this.$element[0].files[0];\n\n            var reader = new FileReader();\n            var self = this;\n            reader.onload = (function (file){\n                return function (e) {\n                    var $img = self.$template.find('img');\n                    if ($img.length == 0) {\n                        $img = $(self.templateImg).attr('src', e.target.result);\n                        self.$template.find('.imagepicker__hover-place').append($img);\n                    } else {\n                        self.$template.find('img.imagepicker__miniature').attr('src', e.target.result);\n                    }\n                };\n            })(file);\n\n            reader.readAsDataURL(file);\n        }\n    }\n\n    var ImagePicker = function (option) {\n        return this.each(function () {\n            new ImagePickerElem(this, option);\n        });\n    };\n\n    var old = $.fn.imagepicker;\n\n    $.fn.imagepicker = ImagePicker;\n    $.fn.imagepicker.constructor = ImagePicker;\n\n    $.fn.imagepicker.noConflict = function () {\n        $.fn.imagepicker = old;\n        return this;\n    }\n\n}(jQuery);","+function ($) {\n\n\n    var YMapElement = function (element, $options) {\n\n        this.$templateModal = $(this.templateModal);\n        this.$element = $(element);\n\n        /* Инициализируем id самого модального окна */\n        this.idModal = this.$element.data('id-modal');\n        if (this.idModal == undefined || this.idModal == '') {\n            throw new Error('Не задан атрибут data-id-modal');\n        }\n\n        /* Инициализируем id карты для дальнейшей работы с картой */\n        this.idMap = this.$element.data('id-map');\n        if (this.idMap == undefined || this.idMap == '') {\n            throw new Error('Не задан атрибут data-id-map');\n        }\n\n        /* Проверим, подгружен ли объект ymaps и если нет то выкинем ошибку */\n        if (!ymaps) {\n            throw new Error('Не подключены яндекс карты');\n        }\n\n        this.nameTechInput = this.$element.data('hidden-name');\n        if (this.nameTechInput == undefined || this.nameTechInput == '') {\n            throw new Error('Не задан атрибут data-hidden-name');\n        }\n\n        /* Посмотрим технические данные и человекопонятный адрес в элементе */\n        this.technicalData = this.$element.data('tech-data');\n        this.userData = this.$element.val();\n\n        /* Добавляем поле для сохранения технической информации */\n        this.$hiddenInput = $('<input type=\"hidden\">');\n        this.$hiddenInput.attr('name', this.nameTechInput);\n        this.$hiddenInput.val(this.technicalData);\n        /* Преобразуем технические данные в массив для дальнейшей работы */\n        this.technicalData = this.technicalData.split(',');\n        this.$element.after(this.$hiddenInput);\n\n        /* Текуший элемент только readonly */\n        this.$element.attr('readonly', true);\n\n        this.$templateModal.attr('id', this.idModal);\n        this.$templateModal.find('.maps > div').attr('id', this.idMap);\n\n        $('body').append(this.$templateModal);\n\n\n        var self = this;\n        this.$element.on('click', function() {\n            /* инициализируем карту исходя из установленных значений */\n            self.initMap();\n            $('#'+self.idModal).modal('show');\n        });\n\n        /* Инизиализируем сохранение данных после выбора объекта на карте */\n        this.$templateModal.find('form').on('submit', function () {\n            self.saveSelectedObject();\n            $('#'+self.idModal).modal('hide');\n            return false;\n        })\n\n        /* Инициализируем карту */\n        ymaps.ready(function () {\n            self.map = new ymaps.Map(self.idMap, {\n                center: self.defaults.defaultShowPoint,\n                zoom: self.defaults.zoom,\n                controls: [],\n            });\n\n            self.searchControl = new ymaps.control.SearchControl({\n                options: {\n                    provider: 'yandex#search'\n                }\n            });\n\n            self.map.controls.add(self.searchControl);\n\n            self.searchControl.events.add('resultselect', function (e) {\n                var index = self.searchControl.getSelectedIndex(e);\n                var result = self.searchControl.getResult(index);\n                result.then(function (res) {\n                    self.objectSelected (res);\n                }, function(err) {\n                    console.log(err);\n                });\n            });\n\n        });\n\n\n    };\n\n    YMapElement.prototype.initMap = function () {\n        /* Берем техническую информацию, создаем объект геолокации, добавляем его на карту */\n        this.technicalData = this.$element.data('tech-data');\n        this.selectedCoordinats = this.technicalData = this.technicalData.split(',');\n        this.userData = this.$element.val();\n\n        this.$templateModal.find('input[name=\"address\"]').val(this.userData);\n        if (ymaps && ymaps.Placemark && this.technicalData.length == 2) {\n            var Placemark = new ymaps.Placemark(this.technicalData);\n            this.map.geoObjects.add(Placemark);\n            this.map.setCenter(this.technicalData, 16);\n        }\n    }\n\n    /* Функция обработки выбранного объекта на карте */\n    YMapElement.prototype.objectSelected = function (searchResult) {\n        /* searchResult тип IGeoObject */\n        /* Достаем человекопонятный адрес и координаты */\n        this.$templateModal.find('input[name=\"address\"]').val(searchResult.properties._data.address);\n        this.selectedCoordinats = searchResult.geometry.getCoordinates();\n    }\n\n    /* Функция для присвоения полученного результата в соответствующие поля формы для дальнейшего сохранения */\n    YMapElement.prototype.saveSelectedObject = function () {\n        var coordinats = this.selectedCoordinats;\n        var textOfAddress = this.$templateModal.find('input[name=\"address\"]').val();\n\n        if (coordinats != '' && textOfAddress != '') {\n            this.$element.val(textOfAddress);\n            this.$element.data('tech-data', coordinats.join(','));\n            this.$hiddenInput.val(coordinats);\n        }\n    }\n\n    /* Опции отображения карты */\n    YMapElement.prototype.defaults = {\n        defaultShowPoint: [59.939095, 30.315868], //Точка центрирования карты по умолчанию\n        zoom: 10,\n    };\n\n    /* Шабон модального окна с картой */\n    YMapElement.prototype.templateModal = '<div class=\"modal fade\" id=\"\" tabindex=\"-1\" role=\"dialog\">'+\n                                                '<div class=\"modal-dialog\">'+\n                                                    '<div class=\"modal-content\">'+\n                                                        '<form class=\"form-horizontal\">'+\n                                                            '<div class=\"modal-header\">'+\n                                                                '<button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">'+\n                                                                    '<span aria-hidden=\"true\">&times;</span>'+\n                                                                '</button>'+\n                                                                '<h4 class=\"modal-title\"></h4>'+\n                                                            '</div>'+\n                                                            '<div class=\"modal-body\">'+\n                                                                '<div class=\"form-group maps\">'+\n                                                                    '<div class=\"col-sm-12\" id=\"\" style=\"height:300px;\"></div>'+\n                                                                '</div>'+\n                                                                '<div class=\"form-group\">'+\n                                                                    '<div class=\"col-sm-12\">'+\n                                                                        '<input type=\"text\" class=\"form-control\" name=\"address\" readonly>'+\n                                                                    '</div>'+\n                                                                '</div>' +\n                                                            '</div>'+\n                                                            '<div class=\"modal-footer\">'+\n                                                                '<button type=\"submit\" class=\"btn btn-primary\">Выбрать</button>'+\n                                                                '<button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Отмена</button> '+\n                                                            '</div>'+\n                                                        '</form>'+\n                                                    '</div>'+\n                                                '</div>'+\n                                            '</div>';\n\n    var YMap = function (option) {\n        return this.each(function () {\n            //Тут каждый элемент из всей выборки\n            new YMapElement(this, option);\n        });\n    };\n\n    var old = $.fn.ymap;\n\n    $.fn.ymap = YMap;\n    $.fn.ymap.constructor = YMap;\n\n    $.fn.ymap.noConflict = function () {\n        $.fn.ymap = old;\n        return this;\n    }\n} (jQuery);"],"sourceRoot":"/source/"}