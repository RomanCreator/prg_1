{"version":3,"sources":["phone-panel.js","searchmap.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"frontend.js","sourcesContent":["/**\n * Created by roman on 25.07.16.\n */\nvar PhonePanel = function (selector) {\n\n    this.$panel = $(selector);\n    this.$buttonToggle = this.$panel.find('.phone-panel__footer');\n    this.$body = this.$panel.find('.phone-panel__body');\n    var self = this;\n    this.$buttonToggle.bind('click', function(ev) {\n        ev.stopPropagation();\n        self.showForm();\n    });\n\n    this.$body.bind('click', function (ev) {\n        ev.stopPropagation();\n    });\n\n    $('body').bind('click', function (){\n        self.hideForm();\n    });\n}\n\nPhonePanel.prototype.showForm = function () {\n    this.$body.show();\n}\n\nPhonePanel.prototype.hideForm = function () {\n    this.$body.hide();\n}\n\nPhonePanel.prototype.sendForm = function () {\n    console.log ('Отрпавляем форму');\n}\n\n$(document).ready (function (){\n    new PhonePanel('.phone-panel.enabled');\n});","/**\n * Created by roman on 09.08.16.\n */\nvar SearchMap = function (selector) {\n    this.defaultCenterMap = [59.939095, 30.315868];\n    this.defaultZoom = 16;\n    this.defaultPlacemark = '/img/icon_placemark.png';\n\n    this.templateInfoWindow = '<div class=\"searchmap__window\">'+\n                                    '<div class=\"searchmap__window__header\">'+\n                                        '<span class=\"searchmap__window__header__label\"></span>'+\n                                    '</div>'+\n                                    '<div class=\"searchmap__window__body\">'+\n                                        '<div class=\"searchmap__window__district\"></div>'+\n                                        '<div class=\"searchmap__window__address\"></div>'+\n                                        '<ul class=\"searchmap__window__workweek\"></ul>'+\n                                        '<div class=\"searchmap__window__phone\">(812) 490-75-73</div>'+\n                                        '<div class=\"searchmap__window__promophone\">'+\n                                            '<div class=\"searchmap__window__promophone__label\">Запишитесь по номеру</div>'+\n                                            '8 (800) 888-00-00'+\n                                        '</div>'+\n                                    '</div>'+\n                              '</div>';\n\n    this.$mapContainer = $(selector);\n    this.map = null;\n    this.MedicalCenters = this.$mapContainer.data('hospitals');\n    if ((typeof this.MedicalCenters) !== 'object') {\n        this.MedicalCenters = [];\n    }\n\n    var self = this;\n    /* Активизируем карту и расставим тыцки на ней, за одно не забудем у пользователя запросить определение местонахождения */\n    ymaps.ready(function () {\n        /* Определяем пользователя */\n        ymaps.geolocation.get().then (function (res) {\n            var bounds = res.geoObjects.get(0).properties.get('boundedBy');\n            var mapState = ymaps.util.bounds.getCenterAndZoom(\n                    bounds,\n                    [self.$mapContainer.width(), self.$mapContainer.height()]\n            );\n            mapState.controls = [];\n            mapState.zoom = self.defaultZoom;\n            self.map = new ymaps.Map(self.$mapContainer.attr('id'), mapState);\n            self.setObjectsOnAMap();\n        }, function (err) {\n            self.map = new ymaps.Map(self.$mapContainer.attr('id'), {\n                center: self.defaultCenterMap,\n                zoom: self.defaultZoom,\n                controls: []\n            });\n            self.setObjectsOnAMap();\n        });\n\n    });\n};\n\n/* Устанавливает все медицинские центры на карту */\nSearchMap.prototype.setObjectsOnAMap = function () {\n    var countObjects = this.MedicalCenters.length;\n    var collectionOfMedicalCenters = new ymaps.GeoObjectCollection();\n    var self = this;\n\n    for (var i = 0; i < countObjects; i++) {\n        if (this.MedicalCenters[i].technical_address) {\n            if ( (typeof this.MedicalCenters[i].technical_address) !== 'object') {\n                try {\n                    this.MedicalCenters[i].technical_address = JSON.parse(this.MedicalCenters[i].technical_address);\n                } catch (Err) {\n                    continue;\n                }\n            }\n\n            if (!this.MedicalCenters[i].technical_address.coordinates) {\n                continue;\n            }\n\n            var placemark = new ymaps.Placemark(this.MedicalCenters[i].technical_address.coordinates, {\n                        district: this.MedicalCenters[i].district,\n                        address: this.MedicalCenters[i].address,\n                        name: this.MedicalCenters[i].name,\n                        weekwork: this.MedicalCenters[i].weekwork,\n                    },\n                    {\n                        iconLayout: 'default#image',\n                        iconImageHref: this.defaultPlacemark,\n                        iconImageSize: [57, 75],\n                        iconImageOffset: [-29, -75],\n                        draggable: false\n                    });\n            /* Навешиваем событие при клике на метку */\n            placemark.events.add('click', function (e) {\n                self.showInfo(e);\n            });\n\n\n            collectionOfMedicalCenters.add(placemark);\n\n        }\n    }\n\n    this.map.geoObjects.add(collectionOfMedicalCenters);\n}\n\n/* Отображает информацию о медицинском центре */\nSearchMap.prototype.showInfo = function (placemark) {\n    var $window = $(this.templateInfoWindow);\n    this.$mapContainer.find($window.attr('class')).remove();\n    $window.find('.searchmap__window__header__label').text(placemark._cache.target.properties._data.name);\n    $window.find('.searchmap__window__district').text(placemark._cache.target.properties._data.district);\n    $window.find('.searchmap__window__address').text(placemark._cache.target.properties._data.address);\n    var workWeek = null;\n    var workWeekProp = placemark._cache.target.properties._data.weekwork;\n    for (var i =0; i < workWeekProp.length; i++) {\n        workWeek += '<li>'+workWeekProp[i]+'</li>';\n    }\n    $window.find('.searchmap__window__workweek').append(workWeek);\n    this.$mapContainer.append($window);\n}\n\n\n\n$(document).ready(function () {\n    new SearchMap('.searchmap');\n});"],"sourceRoot":"/source/"}